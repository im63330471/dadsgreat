<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Millionaire Quiz</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body, * {
            font-family: 'Georgia', serif !important;
        }
        body {
            background: #f0f8ff;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100vw;
            min-height: 100vh;
            justify-content: center;
        }
        .game-area {
            display: flex;
            flex-direction: row;
            justify-content: center;
            width: 100%;
            max-width: 700px;
        }
        .quiz-container {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 1.5rem 1.5rem 1.5rem 1.5rem;
            margin: 0 1.5rem 1.5rem 0;
            width: 270px;
            min-height: 220px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .question {
            font-size: 2.2rem;
            margin-bottom: 1.2rem;
            color: #1976d2;
            text-align: center;
            font-family: 'Georgia', serif !important;
        }
        .answers button {
            display: block;
            width: 100%;
            margin: 0.4rem 0;
            padding: 0.6rem;
            font-size: 1.1rem;
            border-radius: 8px;
            border: none;
            background: #4fc3f7;
            color: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }
        .answers button:hover {
            background: #1976d2;
        }
        .result {
            font-size: 1.3rem;
            color: #d84315;
            margin-top: 1.2rem;
            text-align: center;
        }
        .restart {
            margin-top: 1.5rem;
            background: #ffb300;
            color: #fff;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }
        .restart:hover {
            background: #f57c00;
        }
        .ladder-container {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 1.5rem 1.2rem;
            margin: 0 0 1.5rem 1.5rem;
            width: 140px;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .ladder {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .ladder li {
            font-size: 1.1rem;
            padding: 0.3rem 0.5rem;
            margin: 0.08rem 0;
            border-radius: 6px;
            background: #e3f2fd;
            color: #1976d2;
            text-align: right;
        }
        .ladder li.current {
            background: #ffd600;
            color: #d84315;
            font-weight: bold;
            border: 2px solid #1976d2;
        }
        /* Remove column layout for small screens, always row */
        @media (max-width: 800px) {
            .game-area {
                flex-direction: row !important;
                align-items: flex-start;
            }
            .quiz-container, .ladder-container {
                margin: 1rem 0.5rem;
                width: 90%;
                max-width: 350px;
            }
        }
        /* Style for Final answer button to match Start button */
        #final-answer-btn {
            display: block;
            margin: 2.2rem auto 0 auto !important;
            background: #4fc3f7;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.7rem 2.5rem;
            font-size: 1.2rem;
            font-family: 'Georgia', serif !important;
            font-weight: normal;
            cursor: pointer;
            width: auto !important;
            height: auto !important;
            letter-spacing: 1px;
            transition: background 0.2s;
        }
        #final-answer-btn:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="start-screen" style="width:100vw; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div style="font-size:2.5rem; color:#1976d2; font-weight:bold; margin-bottom:2rem; letter-spacing:2px;">MATH MILLIONAIRE</div>
            <form id="type-form" style="background:#fff; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.08); padding:2rem 2.5rem; display:flex; flex-direction:column; align-items:center;">
                <div style="font-size:1.2rem; margin-bottom:1rem;">Choose question types:</div>
                <div id="checkbox-area" style="display:flex; flex-direction:column; align-items:flex-start; margin-bottom:2rem;"></div>
                <button type="submit" style="font-size:1.2rem; background:#4fc3f7; color:#fff; border:none; border-radius:8px; padding:0.7rem 2.5rem; cursor:pointer;">Start</button>
            </form>
        </div>
        <div class="game-area" id="game-area" style="display:none;">
            <div class="quiz-container">
                <div class="question" id="question"></div>
                <div class="answers" id="answers"></div>
                <div class="result" id="result"></div>
                <button class="restart" id="restart" style="display:none;">Restart</button>
            </div>
            <div class="ladder-container">
                <ul class="ladder" id="ladder"></ul>
            </div>
        </div>
    </div>
    <script>
        const questionTypes = [
            "Total is 5, one of the number is between 1-4, ask another number",
            "Total is 10, one of the number is between 1-9, ask another number",
            "Two numbers, total is between 6-10, ask total",
            "Two numbers, total is between 11-20, ask total",
            "Total is 20, one of the number is between 1-19, ask another number",
            "Total is between 11-15, one of the number is between 1-9, ask another number",
            "Total is between 16-20, one of the number is between 6-14, ask another number",
            "First number is between 11-15, second number is between 2-6, ask the difference",
            "First number is between 16-20, second number is between 7-11, ask the difference",
            "First number is between 11-15, difference is between 2-6, ask second number",
            "First number is between 16-20, difference is between 7-11, ask second number"
        ];
        const questionLabels = [
            "加埋等如 5",
            "加埋等如 10",
            "加數 (6-10)",
            "加數 (11-20)",
            "加埋等如 20",
            "1-9 加什麼等如 11-15",
            "6-14 加什麼等如 16-20",
            "11-15 減 2-6",
            "16-20 減 7-11",
            "11-15 減什麼等如 2-6",
            "16-20 減什麼等如 7-11"
        ];
        // Prize ladder
        const prizeLadder = [
            1000, 2000, 3000, 4000, 6000,
            10000, 20000, 30000, 40000, 60000,
            80000, 150000, 250000, 500000, 1000000
        ];

        // Generate question by type
        function generateQuestionByType(typeIdx) {
            switch(typeIdx) {
                case 0: {
                    // Total is 5, one number 1-4, ask another number (randomly ask for first or second)
                    const a = Math.floor(Math.random()*4)+1;
                    const b = 5 - a;
                    if (Math.random() < 0.5) {
                        // ask for first
                        const shuf = shuffleAnswers([a, ...uniqueRandoms(1,4,3,a)], a);
                        return {
                            question: `? + ${b} = 5`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    } else {
                        // ask for second
                        const shuf = shuffleAnswers([b, ...uniqueRandoms(1,4,3,b)], b);
                        return {
                            question: `${a} + ? = 5`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    }
                }
                case 1: {
                    // Total is 10, one number 1-9, ask another number (randomly ask for first or second)
                    const a = Math.floor(Math.random()*9)+1;
                    const b = 10 - a;
                    if (Math.random() < 0.5) {
                        const shuf = shuffleAnswers([a, ...uniqueRandoms(1,9,3,a)], a);
                        return {
                            question: `? + ${b} = 10`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    } else {
                        const shuf = shuffleAnswers([b, ...uniqueRandoms(1,9,3,b)], b);
                        return {
                            question: `${a} + ? = 10`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    }
                }
                case 2: {
                    const total = Math.floor(Math.random()*5)+6;
                    const a = Math.floor(Math.random()*(total-1))+1;
                    const b = total - a;
                    const shuf = shuffleAnswers([total, ...uniqueRandoms(6,10,3,total)], total);
                    return {
                        question: `${a} + ${b} = ?`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
                case 3: {
                    const total = Math.floor(Math.random()*10)+11;
                    const a = Math.floor(Math.random()*(total-1))+1;
                    const b = total - a;
                    const shuf = shuffleAnswers([total, ...uniqueRandoms(11,20,3,total)], total);
                    return {
                        question: `${a} + ${b} = ?`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
                case 4: {
                    const a = Math.floor(Math.random()*19)+1;
                    const b = 20 - a;
                    if (Math.random() < 0.5) {
                        const shuf = shuffleAnswers([a, ...uniqueRandoms(1,19,3,a)], a);
                        return {
                            question: `? + ${b} = 20`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    } else {
                        const shuf = shuffleAnswers([b, ...uniqueRandoms(1,19,3,b)], b);
                        return {
                            question: `${a} + ? = 20`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    }
                }
                case 5: {
                    const total = Math.floor(Math.random()*5)+11;
                    const a = Math.floor(Math.random()*9)+1;
                    let b = total - a;
                    if (b <= 0) b = 1;
                    if (Math.random() < 0.5) {
                        const shuf = shuffleAnswers([a, ...uniqueRandoms(1,9,3,a)], a);
                        return {
                            question: `? + ${b} = ${total}`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    } else {
                        const shuf = shuffleAnswers([b, ...uniqueRandoms(1,9,3,b)], b);
                        return {
                            question: `${a} + ? = ${total}`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    }
                }
                case 6: {
                    const total = Math.floor(Math.random()*5)+16;
                    const a = Math.floor(Math.random()*9)+6;
                    let b = total - a;
                    if (b <= 0) b = 1;
                    if (Math.random() < 0.5) {
                        const shuf = shuffleAnswers([a, ...uniqueRandoms(6,14,3,a)], a);
                        return {
                            question: `? + ${b} = ${total}`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    } else {
                        const shuf = shuffleAnswers([b, ...uniqueRandoms(1,14,3,b)], b);
                        return {
                            question: `${a} + ? = ${total}`,
                            answers: shuf.answers,
                            correct: shuf.correct,
                            typeIdx: typeIdx
                        };
                    }
                }
                case 7: {
                    const a = Math.floor(Math.random()*5)+11;
                    const b = Math.floor(Math.random()*5)+2;
                    const diff = a - b;
                    const shuf = shuffleAnswers([diff, ...uniqueRandoms(5,13,3,diff)], diff);
                    return {
                        question: `${a} - ${b} = ?`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
                case 8: {
                    const a = Math.floor(Math.random()*5)+16;
                    const b = Math.floor(Math.random()*5)+7;
                    const diff = a - b;
                    const shuf = shuffleAnswers([diff, ...uniqueRandoms(5,13,3,diff)], diff);
                    return {
                        question: `${a} - ${b} = ?`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
                case 9: {
                    const a = Math.floor(Math.random()*5)+11;
                    const diff = Math.floor(Math.random()*5)+2;
                    const b = a - diff;
                    const shuf = shuffleAnswers([b, ...uniqueRandoms(5,13,3,b)], b);
                    return {
                        question: `${a} - ? = ${diff}`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
                case 10: {
                    const a = Math.floor(Math.random()*5)+16;
                    const diff = Math.floor(Math.random()*5)+7;
                    const b = a - diff;
                    const shuf = shuffleAnswers([b, ...uniqueRandoms(5,13,3,b)], b);
                    return {
                        question: `${a} - ? = ${diff}`,
                        answers: shuf.answers,
                        correct: shuf.correct,
                        typeIdx: typeIdx
                    };
                }
            }
        }
        // Helper: shuffle answers and set correct index, but sort answers ascending
        function shuffleAnswers(arr, correctValue) {
            arr = Array.from(new Set(arr)); // remove duplicates
            arr.sort((a, b) => a - b);
            return {answers: arr, correct: arr.indexOf(correctValue)};
        }
        // Helper: get unique randoms in range, excluding a value
        function uniqueRandoms(min, max, count, exclude) {
            const set = new Set();
            while (set.size < count) {
                let n = Math.floor(Math.random() * (max - min + 1)) + min;
                if (n !== exclude) set.add(n);
            }
            return Array.from(set);
        }
        // Render checkboxes
        const checkboxArea = document.getElementById('checkbox-area');
        questionLabels.forEach((label, idx) => {
            const div = document.createElement('div');
            div.style.marginBottom = '0.5rem';
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.id = 'qtype' + idx;
            cb.value = idx;
            cb.style.marginRight = '0.5rem';
            div.appendChild(cb);
            const lab = document.createElement('label');
            lab.htmlFor = cb.id;
            lab.textContent = label;
            div.appendChild(lab);
            checkboxArea.appendChild(div);
        });
        // Game logic
        let questions = [];
        let current = 0;
        let score = 0;
        const questionEl = document.getElementById('question');
        const answersEl = document.getElementById('answers');
        const resultEl = document.getElementById('result');
        const restartBtn = document.getElementById('restart');
        const ladderEl = document.getElementById('ladder');
        const startScreen = document.getElementById('start-screen');
        const gameArea = document.getElementById('game-area');

        function renderLadder(currentIdx) {
            ladderEl.innerHTML = '';
            for (let i = prizeLadder.length - 1; i >= 0; i--) {
                const li = document.createElement('li');
                li.textContent = `$${prizeLadder[i].toLocaleString()}`;
                if (i === 4 || i === 9) {
                    li.style.fontWeight = 'bold';
                }
                if (i === currentIdx) {
                    li.classList.add('current');
                }
                ladderEl.appendChild(li);
            }
        }

        function showQuestion() {
            if (current < questions.length) {
                const q = questions[current];
                questionEl.textContent = q.question;
                answersEl.innerHTML = '';
                let selectedIdx = null;
                let finalBtn = document.getElementById('final-answer-btn');
                if (finalBtn) finalBtn.remove();
                // Render answer buttons
                q.answers.forEach((ans, idx) => {
                    const btn = document.createElement('button');
                    btn.textContent = ans;
                    btn.onclick = () => {
                        // Highlight selected
                        Array.from(answersEl.children).forEach(b => b.style.background = '#4fc3f7');
                        btn.style.background = '#ffd600';
                        selectedIdx = idx;
                        // Show Final answer button
                        if (!document.getElementById('final-answer-btn')) {
                            const finalBtn = document.createElement('button');
                            finalBtn.id = 'final-answer-btn';
                            finalBtn.textContent = 'Final answer?';
                            // Style is now in CSS
                            finalBtn.onclick = () => {
                                if (selectedIdx !== null) {
                                    checkAnswerWithEffect(selectedIdx, btn);
                                }
                            };
                            answersEl.parentNode.insertBefore(finalBtn, answersEl.nextSibling);
                        }
                    };
                    answersEl.appendChild(btn);
                });
                resultEl.textContent = '';
                restartBtn.style.display = 'none';
                renderLadder(current);
                // Show question label at bottom
                let labelIdx = q.typeIdx !== undefined ? q.typeIdx : (typeof q.type === 'number' ? q.type : null);
                if (labelIdx === null) labelIdx = getTypeIdxFromQuestion(q.question);
                let label = labelIdx !== null ? questionLabels[labelIdx] : '';
                let labelDiv = document.getElementById('question-label');
                if (!labelDiv) {
                    labelDiv = document.createElement('div');
                    labelDiv.id = 'question-label';
                    labelDiv.style.marginTop = '1.5rem';
                    labelDiv.style.fontSize = '1.1rem';
                    labelDiv.style.textAlign = 'center';
                    // Set color to white for developer purpose
                    labelDiv.style.color = '#fff';
                    document.querySelector('.quiz-container').appendChild(labelDiv);
                } else {
                    labelDiv.style.color = '#fff';
                }
                labelDiv.textContent = label;
            } else {
                showResult();
            }
        }

        // Helper: flash effect for correct answer
        function flashGreen(btn, times, cb) {
            if (times <= 0) { btn.style.background = '#43a047'; if (cb) cb(); return; }
            btn.style.background = times % 2 === 0 ? '#43a047' : '#ffd600';
            setTimeout(() => flashGreen(btn, times - 1, cb), 180);
        }

        function checkAnswerWithEffect(idx, btn) {
            // Remove Final answer button
            let finalBtn = document.getElementById('final-answer-btn');
            if (finalBtn) finalBtn.remove();
            if (idx === questions[current].correct) {
                // Flash green effect
                flashGreen(btn, 6, () => {
                    score++;
                    current++;
                    showQuestion();
                });
            } else {
                btn.style.background = '#d84315';
                setTimeout(() => showResult(), 700);
            }
        }

        function checkAnswer(idx) {
            if (idx === questions[current].correct) {
                score++;
                current++;
                showQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            questionEl.textContent = '';
            answersEl.innerHTML = '';
            renderLadder(score - 1);
            // Safety net logic
            let safePrize = 0;
            if (score > 9) safePrize = 60000;
            else if (score > 4) safePrize = 6000;
            if (score === questions.length) {
                resultEl.textContent = '🎉 You Win! Prize: $' + prizeLadder[score-1].toLocaleString();
            } else if (score > 0) {
                let won = prizeLadder[score-1];
                if (score < 5) won = 0;
                else if (score < 10) won = 6000;
                else won = 60000;
                resultEl.textContent = `You won $${won.toLocaleString()}`;
            } else {
                resultEl.textContent = `You won $0. Try again!`;
            }
            restartBtn.style.display = 'inline-block';
            // Remove question label
            let labelDiv = document.getElementById('question-label');
            if (labelDiv) labelDiv.textContent = '';
        }

        // Avoid duplicate questions in a session
        function generateUniqueQuestions(typeIdx, count, existingQuestions) {
            const set = new Set(existingQuestions.map(q => q.question));
            let tries = 0;
            while (count > 0 && tries < 1000) {
                const q = generateQuestionByType(typeIdx);
                if (!set.has(q.question)) {
                    existingQuestions.push(q);
                    set.add(q.question);
                    count--;
                }
                tries++;
            }
        }

        document.getElementById('type-form').onsubmit = function(e) {
            e.preventDefault();
            const checked = Array.from(checkboxArea.querySelectorAll('input[type=checkbox]:checked')).map(cb => parseInt(cb.value));
            if (checked.length === 0) {
                alert('Please select at least one question type.');
                return;
            }
            questions = [];
            if (checked.length === 1) {
                generateUniqueQuestions(checked[0], 15, questions);
            } else if (checked.length === 2) {
                generateUniqueQuestions(checked[0], 7, questions);
                generateUniqueQuestions(checked[1], 8, questions);
            } else if (checked.length === 3) {
                generateUniqueQuestions(checked[0], 5, questions);
                generateUniqueQuestions(checked[1], 5, questions);
                generateUniqueQuestions(checked[2], 5, questions);
            }
            current = 0;
            score = 0;
            startScreen.style.display = 'none';
            gameArea.style.display = 'flex';
            showQuestion();
        };

        restartBtn.onclick = () => {
            startScreen.style.display = 'flex';
            gameArea.style.display = 'none';
        };

        showQuestion();
    </script>
</body>
</html>
